<html lang="en">

<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<title>[DCN]浅谈无线VLAN的设置 - Hooyu&#39;s Note</title>
<link rel="shortcut icon" href="https://blog.ikozn.com//favicon.ico">
<link href="https://cdn.jsdelivr.net/npm/remixicon@2.2.0/fonts/remixicon.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.7.2/animate.min.css">
<link rel="stylesheet" href="https://blog.ikozn.com//media/css/tailwind.css">
<link rel="stylesheet" href="https://blog.ikozn.com//styles/main.css">
<link rel="alternate" type="application/atom+xml" title="[DCN]浅谈无线VLAN的设置 - Hooyu&#39;s Note - Atom Feed" href="https://blog.ikozn.com//atom.xml">

    

  <meta name="description" content="
首先我们来看一个常见的错误配置方式
拓扑



需求
1.网络拓扑如上图所示，AC是无线控制器，其E1/0/1口连接着AP的LAN1口
2.按照 表1-1 完成无线网络的配置.使用户连接WLAN使能够获取对应VLAN的IP地址。AP地址通..." />
  <meta property="og:title" content="[DCN]浅谈无线VLAN的设置 - Hooyu&#39;s Note">
  <meta property="og:description" content="
首先我们来看一个常见的错误配置方式
拓扑



需求
1.网络拓扑如上图所示，AC是无线控制器，其E1/0/1口连接着AP的LAN1口
2.按照 表1-1 完成无线网络的配置.使用户连接WLAN使能够获取对应VLAN的IP地址。AP地址通..." />
  <meta property="og:type" content="articles">
  <meta property="og:url" content="https://blog.ikozn.com/post/DCN-浅谈无线VLAN的设置" />
  <meta property="og:image" content="https://blog.ikozn.com//images/avatar.png">
  <meta property="og:image:height" content="630">
  <meta property="og:image:width" content="1200">
  <meta name="twitter:title" content="[DCN]浅谈无线VLAN的设置 - Hooyu&#39;s Note">
  <meta name="twitter:description" content="
首先我们来看一个常见的错误配置方式
拓扑



需求
1.网络拓扑如上图所示，AC是无线控制器，其E1/0/1口连接着AP的LAN1口
2.按照 表1-1 完成无线网络的配置.使用户连接WLAN使能够获取对应VLAN的IP地址。AP地址通...">
  <meta name="twitter:card" content="summary_large_image">
  <link rel="canonical" href="https://blog.ikozn.com/post/DCN-浅谈无线VLAN的设置">

  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.css">
 
  
    <link rel="stylesheet" href="https://blog.ikozn.com//media/css/prism-atom-dark.css">
  

  
</head>

<body>
  <div class="antialiased flex flex-col min-h-screen" id="app">
    <a href="https://blog.ikozn.com/" class="fixed top-0 left-0 mt-4 bg-black text-white dark:text-gray-700 dark:bg-yellow-50 dark:hover:bg-black dark:hover:text-white inline-flex p-2 pl-8 hover:text-gray-700 hover:bg-yellow-50 font-bold z-10 transition-fast animated fadeInLeft">
      Hooyu&#39;s Note
    </a>
    <div class="max-w-4xl w-full mx-auto">
      <div class="shadow-box bg-white dark:bg-gray-600 rounded-lg pt-32 md:pt-64 px-4 md:px-8 pb-8 animated fadeIn mb-8">
        <h1 class="text-5xl font-semibold leading-normal pb-8 mb-8 border-b-8 border-gray-700">
          [DCN]浅谈无线VLAN的设置
        </h1>
        
        <div class="mb-8 flex flex-wrap">
          <div class="text-gray-400 text-sm mr-4">2018-03-12 · 14 min read</div>
          
            <a href="https://blog.ikozn.com/tag/_Kz1iaYaah" class="text-gray-700 text-sm border-b-2 border-dotted border-gray-200 hover:border-gray-600 transition-all duration-100 inline-flex mr-2">
              <i class="ri-hashtag"></i>
              WLAN
            </a>
          
            <a href="https://blog.ikozn.com/tag/V5g_FuAyr_" class="text-gray-700 text-sm border-b-2 border-dotted border-gray-200 hover:border-gray-600 transition-all duration-100 inline-flex mr-2">
              <i class="ri-hashtag"></i>
              无线
            </a>
          
            <a href="https://blog.ikozn.com/tag/rEkuMBNIjl" class="text-gray-700 text-sm border-b-2 border-dotted border-gray-200 hover:border-gray-600 transition-all duration-100 inline-flex mr-2">
              <i class="ri-hashtag"></i>
              神州数码
            </a>
          
            <a href="https://blog.ikozn.com/tag/SA6_Hsrefy" class="text-gray-700 text-sm border-b-2 border-dotted border-gray-200 hover:border-gray-600 transition-all duration-100 inline-flex mr-2">
              <i class="ri-hashtag"></i>
              DCN
            </a>
          
            <a href="https://blog.ikozn.com/tag/j1B6RKT2qV" class="text-gray-700 text-sm border-b-2 border-dotted border-gray-200 hover:border-gray-600 transition-all duration-100 inline-flex mr-2">
              <i class="ri-hashtag"></i>
              配置
            </a>
          
        </div>
        <div class="markdown mb-8" v-pre>
          <!--more-->
<p>首先我们来看一个常见的错误配置方式</p>
<h3 id="拓扑"><strong>拓扑</strong></h3>
<figure data-type="image" tabindex="1"><img src="https://i.loli.net/2018/03/12/5aa600e2bb5a2.png" alt="拓扑" loading="lazy"></figure>
<br />
<br />
<h3 id="需求"><strong>需求</strong></h3>
<p>1.网络拓扑如上图所示，AC是无线控制器，其E1/0/1口连接着AP的LAN1口</p>
<p>2.按照 表1-1 完成无线网络的配置.使用户连接WLAN使能够获取对应VLAN的IP地址。AP地址通过DHCP下发，为192.168.3.10。</p>
<table>
<thead>
<tr>
<th>VLAN</th>
<th>SVI接口地址</th>
<th>说明</th>
<th>对应SSID</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>192.168.1.254/24</td>
<td>用户VLAN</td>
<td>VLAN1-Wireless-LAB</td>
</tr>
<tr>
<td>2</td>
<td>192.168.2.254/24</td>
<td>用户VLAN</td>
<td>VLAN2-Wireless-LAB</td>
</tr>
<tr>
<td>3</td>
<td>192.168.3.254/24</td>
<td>管理 and 用户VLAN</td>
<td>VLAN3-Wireless-LAB</td>
</tr>
</tbody>
</table>
<center>表1-1</center>
<h3 id="配置及实现"><strong>配置及实现</strong></h3>
<h4 id="1ap上线">1.AP上线</h4>
<br />
<h4 id="划分vlan和设置svi接口地址">划分VLAN和设置SVI接口地址</h4>
<pre><code>AC(config)#vlan 2		//创建VLAN2
AC(config-vlan2)#vlan 3		//创建VLAN3
AC(config-vlan3)#int vlan 1 	//进入Vlan1的SVI接口
AC(config-if-vlan1)#ip ad 192.168.1.254 255.255.255.0		//设置IP地址	
AC(config-if-vlan1)#int vlan 2		//进入VLAN2的SVI接口
AC(config-if-vlan2)#ip ad 192.168.2.254 255.255.255.0		//设置IP地址
AC(config-if-vlan2)#int vlan 3		//进入VLAN3的SVI接口
AC(config-if-vlan3)#ip ad 192.168.3.254 255.255.255.0		//设置IP地址
AC(config-if-ethernet1/0/1)#sw mo trunk 		//更改接口模式为Trunk
AC(config-if-vlan3)#int e1/0/1
AC(config-if-ethernet1/0/1)#sw mo trunk 
AC(config-if-ethernet1/0/1)#switchport trunk native vlan 3		//设置Native VLAN为VLAN3
</code></pre>
<br />
<br />
<h4 id="2-开启dhcp功能自动下发地址">2 开启DHCP功能，自动下发地址。</h4>
<pre><code>AC(config)#ip dhcp pool vlan1 		//创建地址池
AC(dhcp-vlan1-config)#network-address 192.168.1.0 255.255.255.0		//设置下发网段
AC(dhcp-vlan1-config)#default-router 192.168.1.254		
AC(dhcp-vlan1-config)#!
AC(config)#ip dhcp pool vlan2		//创建地址池
AC(dhcp-vlan2-config)#network-address 192.168.2.0 255.255.255.0		//设置下发网段
AC(dhcp-vlan2-config)#default-router 192.168.2.254 		//设置网关
AC(dhcp-vlan2-config)#!
AC(config)#ip dhcp pool vlan3       //创建地址池                
AC(dhcp-vlan3-config)#network-address 192.168.3.0 255.255.255.0		//设置下发网段
AC(dhcp-vlan3-config)#default-router 192.168.3.254		//设置网关
AC(dhcp-vlan3-config)#!
AC(config)#service dhcp		//开启DHCP服务
</code></pre>
<br />
<br />
<h4 id="3-dhcp静态绑定ap地址">3 DHCP静态绑定AP地址</h4>
<p><strong>AC</strong></p>
<pre><code>AC(config)#show ip dh binding 		//查看DHCP绑定
Total dhcp binding items: 1, the matched: 1
IP address          Hardware address         Lease expiration         Type
192.168.3.1         00-03-0F-5B-F0-E0        Mon Jan 02 00:30:00 2006 Dynamic

AC(config)#ip dhcp pool AP		//添加DHCP池
AC(dhcp-ap-config)#hardware-address 00-03-0F-5B-F0-E0		//绑定MAC地址
AC(dhcp-ap-config)#host 192.168.3.10		//绑定IP
AC(dhcp-ap-config)#default-router 192.168.3.254		//设置网关
AC(dhcp-ap-config)#!
AC(config)#show ip dh binding                
Total dhcp binding items: 1, the matched: 1
IP address          Hardware address         Lease expiration         Type
192.168.3.10        00-03-0F-5B-F0-E0        Infinite                 Manual
</code></pre>
<br />
<br />
<p><strong>AP</strong></p>
<p>重启的DHCP功能</p>
<pre><code>AP# set management dhcp-status down	//关闭DHCP获取地址
AP# set management dhcp-status up  	//开启DHCP获取地址
AP# get management 
Property                   Value
--------------------------------------------
vlan-id                    1
interface                  brvlan1
static-ip                  192.168.1.10
static-mask                255.255.255.0
ip                         192.168.3.10		//获取到了192.168.3.10
mask                       255.255.255.0
ipv6                       
ipv6-prefix-length         0
mac                        00:03:0F:5B:F0:E0
dhcp-status                up
dhcpv6-status              down
ipv6-status                up
ipv6-autoconfig-status     up
static-ipv6                
static-ipv6-prefix-length  0
</code></pre>
<br />
<br />
<h4 id="4-开启ac无线功能">4 开启AC无线功能</h4>
<pre><code>AC(config-wireless)#no auto-ip-assign 		//关闭无线地址选举
AC(config-wireless)#static-ip 192.168.3.254		//设置静态无线地址
AC(config-wireless)#discovery vlan-list 3		//设置二层发现VLAN
AC(config-wireless)#ap authentication none 		//关闭AP验证
AC(config-wireless)#enable 		//开启无线功能
查看AP状态
AC(config)#show wir ap status 

    MAC Address                                                            Configuration                
 (*) Peer Managed  IP Address                              Profile Status     Status           Age      
------------------ --------------------------------------- ------- ------- ------------- --------------
 00-03-0f-5b-f0-e0 192.168.3.10                            1       Managed Failure       0d:00:00:07

Total Access Points............................ 1
</code></pre>
<br />
<br />
<h4 id="5-无线配置">5 无线配置</h4>
<pre><code>AC(config)#wireless 		//进入无线全局模式
AC(config-wireless)#network 1		//进入network配置模式
AC(config-network)#ssid VLAN1-Wireless-LAB		//设置SSID
AC(config-network)#security mode none 	//关闭用户认证
AC(config-network)#vlan 1		//设置VLAN
AC(config-network)#network 2		//进入network配置模式
AC(config-network)#ssid VLAN2-Wireless-LAB
AC(config-network)#security mode none 		//关闭用户认证
AC(config-network)#vlan 2		//设置VLAN
AC(config-network)#network 3		//进入network配置模式
AC(config-network)#ssid VLAN3-Wireless-LAB
AC(config-network)#security mode none 		//关闭用户认证
AC(config-network)#vlan 3		//设置VLAN
AC(config-network)#!
AC(config-wireless)#ap profile 1		//进入profile 1
AC(config-ap-profile)#hwtype 29		//设置硬件号
AC(config-ap-profile)#radio 1		//进入radio配置模式
AC(config-ap-profile-radio)#vap 1		//进入vap配置模式
AC(config-ap-profile-vap)#enable 		//开启vap
AC(config-ap-profile-vap)#vap 2		//进入VAP配置模式
AC(config-ap-profile-vap)#enable 	//开启VAP
AC(config-ap-profile-vap)#!
AC(config-ap-profile-radio)#!
AC(config-ap-profile)#!
AC(config-wireless)#!
AC(config)#!
AC(config)#exit
AC#wir ap prof ap 1		//下发配置文件
All configurations will be send to the aps associated to this profile and associated clients on these aps will be disconnected. Are you sure you want to apply the profile configuration? [Y/N] y
</code></pre>
<hr>
<h4 id="6测试">6.测试</h4>
<p>配置文件下发之后，稍等一会，就可以搜索到无线信号了。</p>
<figure data-type="image" tabindex="2"><img src="https://i.loli.net/2018/03/12/5aa57b1fe9738.png" alt="WIFI列表" loading="lazy"></figure>
<p>接着我们连上去试试</p>
<p>首先我们连接VLAN1的</p>
<p>结果发现</p>
<figure data-type="image" tabindex="3"><img src="https://i.loli.net/2018/03/12/5aa57c1f5f96d.png" alt="VLAN1连接" loading="lazy"></figure>
<center>竟然获取到了VLAN3的地址</center>
<br />
<center>接下来我们再连接VLAN2的试试</center>
<figure data-type="image" tabindex="4"><img src="https://i.loli.net/2018/03/12/5aa57c1f5f96d.png" alt="VLAN2连接" loading="lazy"></figure>
<center>发现是正常的</center>
<br />
<center>最后再来连接VLAN3</center>
<figure data-type="image" tabindex="5"><img src="https://i.loli.net/2018/03/12/5aa58ea17ceb9.png" alt="VLAN3连接" loading="lazy"></figure>
<center>发现根本获取不到IP地址</center>
<h3 id="问题分析">问题分析</h3>
<h4 id="1拓扑">1.拓扑</h4>
<figure data-type="image" tabindex="6"><img src="https://i.loli.net/2018/03/12/5aa600e2bb5a2.png" alt="拓扑" loading="lazy"></figure>
<br />
<br />
<h4 id="2vlan-1-用户上线过程">2.VLAN 1 用户上线过程</h4>
<figure data-type="image" tabindex="7"><img src="https://i.loli.net/2018/03/12/5aa600abe2514.png" alt="VLAN DHCP过程" loading="lazy"></figure>
<p>**(1).**当用户连接到无线网络之后，客户端发送<code>DHCP DISCOVER</code>广播包来请求IP地址</p>
<p>**(2).**AP默认的转发方式为本地转发，所以<code>DHCP DISCOVER</code>报文到达AP之后802.11帧便被转换成以太网帧。不打VLAN TAG，将数据包转发给交换机。</p>
<p>**(3).**我们在交换机的E1/0/1接口上配置了命令 <code>switchport trunk native vlan 3</code>,所以当没有VLAN Tag的帧到达交换机的时候，被打上VLAN 3的标签.</p>
<p>**(4).**所以最后导致了Client获取到了VLAN3网段的地址</p>
<blockquote>
<p>VLAN1的数据AP不打标签</p>
</blockquote>
<br />
<br />
<h4 id="3vlan-2-用户上线过程">3.VLAN 2 用户上线过程</h4>
<figure data-type="image" tabindex="8"><img src="https://i.loli.net/2018/03/12/5aa601ee7c5d5.png" alt="VLAN2上线" loading="lazy"></figure>
<p>**(1).**当用户连接到无线网络之后，客户端发送<code>DHCP DISCOVER</code>广播包来请求IP地址</p>
<p>**(2).**AP默认的转发方式为本地转发，所以<code>DHCP DISCOVER</code>报文到达AP之后802.11帧便被转换成以太网帧。</p>
<p>打上<code>VLAN 2</code> TAG，将数据包转发给交换机。</p>
<p>**(3).**交换机收到该帧，不对帧进行任何处理，直接放行，最后帧在VLAN2内传播。</p>
<p>**(4).**所以客户机可以获取到正确的地址。</p>
<br />
<br />
<h4 id="4vlan-3-用户上线过程">4.VLAN 3 用户上线过程</h4>
<figure data-type="image" tabindex="9"><img src="https://i.loli.net/2018/03/12/5aa60313a8a84.png" alt="VLAN3上线" loading="lazy"></figure>
<p>**(1).**当用户连接到无线网络之后，客户端发送<code>DHCP DISCOVER</code>广播包来请求IP地址</p>
<p>**(2).**AP默认的转发方式为本地转发，所以<code>DHCP DISCOVER</code>报文到达AP之后802.11帧便被转换成以太网帧。</p>
<p>**(3).**打上<code>VLAN 3</code> TAG，将数据包转发给交换机，然而交换机上配置了<code>switchport trunk native vlan 3</code>，导致交换机丢包，该SSID下所有数据都不能通过交换机，所以最终也不能获取地址。</p>
<br />
<br />
<hr>
<h3 id="解决问题">解决问题</h3>
<p>让我们重新做一遍</p>
<h4 id="1设置vlan">1.设置VLAN</h4>
<pre><code>AC(config)#vlan 2		//创建VLAN2
AC(config-vlan2)#vlan 3		//创建VLAN3
AC(config-vlan3)#int vlan 1 	//进入Vlan1的SVI接口
AC(config-if-vlan1)#ip ad 192.168.1.254 255.255.255.0		//设置IP地址	
AC(config-if-vlan1)#int vlan 2		//进入VLAN2的SVI接口
AC(config-if-vlan2)#ip ad 192.168.2.254 255.255.255.0		//设置IP地址
AC(config-if-vlan2)#int vlan 3		//进入VLAN3的SVI接口
AC(config-if-vlan3)#ip ad 192.168.3.254 255.255.255.0		//设置IP地址
AC(config-if-vlan3)#int e1/0/1
AC(config-if-ethernet1/0/1)#sw mo trunk 		//更改接口模式为Trunk
</code></pre>
<p><strong>注意，这里不设置Native VLAN</strong></p>
<br />
<br />
<h4 id="2设置dhcp">2.设置DHCP</h4>
<p><strong>AP</strong></p>
<p>设置管理VLAN</p>
<pre><code>AP# set management vlan-id 3	//设置管理VLAN为VLAN3
</code></pre>
<blockquote>
<p>设置管理VLAN之后，从AP发出的管理/控制报文都会打上VLAN 3的TAG，也可以接受带VLAN3 TAG的管理报文。</p>
</blockquote>
<br />
<br />
<p><strong>AC</strong></p>
<pre><code>AC(config)#ip dh pool VLAN1
AC(dhcp-vlan1-config)#network-address 192.168.1.0 255.255.255.0
AC(dhcp-vlan1-config)#default-router 192.168.1.254
AC(dhcp-vlan1-config)#!                    
AC(config)#ip dh pool VLAN2
AC(dhcp-vlan2-config)#network-address 192.168.2.0 255.255.255.0
AC(dhcp-vlan2-config)#default-router 192.168.2.254
AC(dhcp-vlan2-config)#!
AC(config)#ip dh pool VLAN3
AC(dhcp-vlan3-config)#network-address 192.168.3.0 255.255.255.0
AC(dhcp-vlan3-config)#default-router 192.168.3.254
AC(dhcp-vlan3-config)#!
AC(config)#service dhcp
</code></pre>
<br />
<br />
<h4 id="3静态绑定dhcp">3.静态绑定DHCP</h4>
<p><strong>AC</strong></p>
<pre><code>AC(config)#show ip dh binding 
Total dhcp binding items: 1, the matched: 1
IP address          Hardware address         Lease expiration         Type
192.168.3.1         aa-aa-aa-aa-aa-aa        Mon Jan 02 00:12:00 2006 Dynamic
AC(config)#ip dhcp pool AP
AC(dhcp-ap-config)#hardware-address aa-aa-aa-aa-aa-aa
AC(dhcp-ap-config)#host 192.168.3.10
AC(dhcp-ap-config)#default-router 192.168.3.254
AC(dhcp-ap-config)#!
</code></pre>
<br />
<p><strong>AP</strong></p>
<pre><code>AP# set management dhcp-status down
AP# set management dhcp-status up  
</code></pre>
<br />
<br />
<h4 id="4开启无线功能">4.开启无线功能</h4>
<pre><code>AC(config-wireless)#no auto-ip-assign 
AC(config-wireless)#static-ip 192.168.3.254
AC(config-wireless)#ap authe none 
AC(config-wireless)#discovery vlan-list 3
AC(config-wireless)#enable 
</code></pre>
<br />
<br />
<h4 id="5配置无线">5.配置无线</h4>
<pre><code>AC(config-wireless)#network 1
AC(config-network)#ssid VLAN1-Wireless-LAB
AC(config-network)#vlan 1
AC(config-network)#network 2
AC(config-network)#ssid VLAN2-Wireless-LAB
AC(config-network)#vlan 2
AC(config-network)#network 3
AC(config-network)#ssid VLAN3-Wireless-LAB
AC(config-network)#vlan 3
AC(config-network)#!
AC(config-wireless)#ap profile 1
AC(config-ap-profile)#hwtype 29
AC(config-ap-profile)#management vlan 3
AC(config-ap-profile)#radio 1
AC(config-ap-profile-radio)#vap 1
AC(config-ap-profile-vap)#enable 
AC(config-ap-profile-vap)#vap 2
AC(config-ap-profile-vap)#enable 
AC(config-ap-profile-vap)#!
AC(config-ap-profile-radio)#!
AC(config-ap-profile)#!
AC#wireless ap prof ap 1
All configurations will be send to the aps associated to this profile and associated clients on these aps will be disconnected. Are you sure you want to apply the profile configuration? [Y/N] y
AP Profile apply is in progress.
</code></pre>
<br />
<br />
<h4 id="6测试-2">6.测试</h4>
<p><strong>VLAN1</strong></p>
<figure data-type="image" tabindex="10"><img src="https://i.loli.net/2018/03/12/5aa60f0615b3b.png" alt="VLAN1" loading="lazy"></figure>
<br />
<br />
<p><strong>VLAN2</strong></p>
<figure data-type="image" tabindex="11"><img src="https://i.loli.net/2018/03/12/5aa60f8f5b204.png" alt="VLAN2" loading="lazy"></figure>
<p><strong>VLAN3</strong></p>
<figure data-type="image" tabindex="12"><img src="https://i.loli.net/2018/03/12/5aa61045a552d.png" alt="VLAN3" loading="lazy"></figure>
<p>可以发现，这次一切都正常了。</p>
<hr>
<h3 id="失误发生的原因">失误发生的原因</h3>
<p>这个配置错误出现的原因主要有以下两点:</p>
<p>**1.**对<code>network</code>配置模型下<code>vlan</code>的命令有所误解</p>
<p>这个命令是设置VLAN表示，设置无线用户的数据在经过AP之后应打上的VLAN TAG，而不是说这个无线信号数据是哪个VLAN，就设置成哪个VLAN。</p>
<br />
<br />
<p>**2.**无线管理VLAN的设置</p>
<p>一般来说，我们设置管理VLAN的时候都是将接口设置为Trunk，并更改接口的本征VLAN.大多数情况下这样子是没有问题的.但是当管理VLAN和用户VLAN是同一个，并且不是VLAN1的时候，情况就有些尴尬.</p>
<p>如上面的第一个实验，当管理和用户VLAN都是VLAN3的时候，我们一般都是这么设置的:</p>
<pre><code>AC(config-if-vlan3)#int e1/0/1
AC(config-if-ethernet1/0/1)#sw mo trunk 
AC(config-if-ethernet1/0/1)#switchport trunk native vlan 3		//设置Native VLAN为VLAN3
</code></pre>
<p><em><strong>更改接口的本征VLAN</strong></em></p>
<br />
<br />
<pre><code>AC(config-network)#network 3		//进入network配置模式
AC(config-network)#ssid VLAN3-Wireless-LAB
AC(config-network)#security mode none 		//关闭用户认证
AC(config-network)#vlan 3		//设置VLAN
</code></pre>
<p><em><strong>在Network下设置VLAN标识</strong></em></p>
<p>如果这么设置，AP转发连接到Network 3的用户流量的时候，就会打上VLAN 3的TAG并发送出去，然而我们的AC接口也将接口的本征VLAN修改为了VLAN3。一但AC收到AP发来带有VLAN 3 TAG的数据帧时，就会将帧丢弃，这就这就导致了我们连上了Network 3却无法访问网络.</p>
<br />
<br />
<p>解决方法有两种</p>
<p>**1.**将network中的vlan标识改回vlan1</p>
<p>如此，当AP转发Network的流量时，就不会打上VLAN TAG，AC接收到数据帧之后，会根据本征VLAN打上VLAN TAG，然后在AC中进行转发。</p>
<p>此方法的代价就是VLAN1不能用来转发无线流量(不能当做用户VLAN).</p>
<br />
<p>**2.**请看[解决问题]篇</p>
<h3 id="总结">总结</h3>
<p>当你的管理VLAN与用户VLAN是同一个VLAN且不是VLAN1的时候，要么放弃使用VLAN1转发数据。</p>
<p>要么在AP上设置管理VLAN.</p>

        </div>
        <!-- Share to Twitter, Weibo, Telegram -->
        <div class="flex items-center">
          <div class="mr-4 flex items-center">
            <i class="ri-share-forward-line text-gray-500"></i>
          </div>
          <div class="px-4 cursor-pointer text-blue-500 hover:bg-blue-100 dark:hover:bg-gray-600 inline-flex" @click="shareToTwitter">
            <i class="ri-twitter-line"></i>
          </div>
          <div class="px-4 cursor-pointer text-red-500 hover:bg-red-100 dark:hover:bg-gray-600 inline-flex" @click="shareToWeibo">
            <i class="ri-weibo-line"></i>
          </div>
          <div class="px-4 cursor-pointer text-indigo-500 hover:bg-indigo-100 dark:hover:bg-gray-600 inline-flex" @click="shareToTelegram">
            <i class="ri-telegram-line"></i>
          </div>
        </div>
      </div>

      
        

        
          <link rel="stylesheet" href="https://unpkg.com/disqusjs@1.1/dist/disqusjs.css">
<script type="application/javascript" src="https://unpkg.com/disqusjs@1.1/dist/disqus.js"></script>

<div id="disqus_thread"></div>

<script type="application/javascript">

var options = {
  shortname: 'hooyus-note',
  apikey: 'jM3YYhM9ZTyi7dH54l4tXx9NvwT51X8psUhmCadx6hkyVNMUtS5rLLs3pFVZW81C',
}
if ('') {
  options.api = ''
}
var dsqjs = new DisqusJS(options)

</script>

        
      

      

      <footer class="py-12 text-center px-4 md:px-0" v-pre>
  Hooyu's Blog
</footer>
    </div>

    <!-- TOC Container -->
    <div class="fixed right-0 bottom-0 mb-16 mr-4 shadow w-8 h-8 rounded-full flex justify-center items-center z-10 cursor-pointer bg-white dark:bg-gray-500 dark:text-gray-200 hover:shadow-lg transition-all animated fadeInRight" @click="showToc = true">
      <i class="ri-file-list-line"></i>
    </div>

    <div class="fixed right-0 top-0 bottom-0 overflow-y-auto w-64 bg-white dark:bg-gray-800 p-4 border-l border-gray-100 dark:border-gray-600 z-10 transition-fast" :class="{ '-mr-64': !showToc }">
      <div class="flex mb-4 justify-end">
        <div class="w-8 h-8 inline-flex justify-center items-center rounded-full cursor-pointer hover:bg-gray-200 dark:hover:bg-gray-600 transition-fast" @click="showToc = false">
          <i class="ri-close-line text-lg"></i>
        </div>
      </div>
      <div class="post-toc-container">
        <ul class="markdownIt-TOC">
<li>
<ul>
<li>
<ul>
<li><a href="#%E6%8B%93%E6%89%91"><strong>拓扑</strong></a></li>
<li><a href="#%E9%9C%80%E6%B1%82"><strong>需求</strong></a></li>
<li><a href="#%E9%85%8D%E7%BD%AE%E5%8F%8A%E5%AE%9E%E7%8E%B0"><strong>配置及实现</strong></a>
<ul>
<li><a href="#1ap%E4%B8%8A%E7%BA%BF">1.AP上线</a></li>
<li><a href="#%E5%88%92%E5%88%86vlan%E5%92%8C%E8%AE%BE%E7%BD%AEsvi%E6%8E%A5%E5%8F%A3%E5%9C%B0%E5%9D%80">划分VLAN和设置SVI接口地址</a></li>
<li><a href="#2-%E5%BC%80%E5%90%AFdhcp%E5%8A%9F%E8%83%BD%E8%87%AA%E5%8A%A8%E4%B8%8B%E5%8F%91%E5%9C%B0%E5%9D%80">2 开启DHCP功能，自动下发地址。</a></li>
<li><a href="#3-dhcp%E9%9D%99%E6%80%81%E7%BB%91%E5%AE%9Aap%E5%9C%B0%E5%9D%80">3 DHCP静态绑定AP地址</a></li>
<li><a href="#4-%E5%BC%80%E5%90%AFac%E6%97%A0%E7%BA%BF%E5%8A%9F%E8%83%BD">4 开启AC无线功能</a></li>
<li><a href="#5-%E6%97%A0%E7%BA%BF%E9%85%8D%E7%BD%AE">5 无线配置</a></li>
<li><a href="#6%E6%B5%8B%E8%AF%95">6.测试</a></li>
</ul>
</li>
<li><a href="#%E9%97%AE%E9%A2%98%E5%88%86%E6%9E%90">问题分析</a>
<ul>
<li><a href="#1%E6%8B%93%E6%89%91">1.拓扑</a></li>
<li><a href="#2vlan-1-%E7%94%A8%E6%88%B7%E4%B8%8A%E7%BA%BF%E8%BF%87%E7%A8%8B">2.VLAN 1 用户上线过程</a></li>
<li><a href="#3vlan-2-%E7%94%A8%E6%88%B7%E4%B8%8A%E7%BA%BF%E8%BF%87%E7%A8%8B">3.VLAN 2 用户上线过程</a></li>
<li><a href="#4vlan-3-%E7%94%A8%E6%88%B7%E4%B8%8A%E7%BA%BF%E8%BF%87%E7%A8%8B">4.VLAN 3 用户上线过程</a></li>
</ul>
</li>
<li><a href="#%E8%A7%A3%E5%86%B3%E9%97%AE%E9%A2%98">解决问题</a>
<ul>
<li><a href="#1%E8%AE%BE%E7%BD%AEvlan">1.设置VLAN</a></li>
<li><a href="#2%E8%AE%BE%E7%BD%AEdhcp">2.设置DHCP</a></li>
<li><a href="#3%E9%9D%99%E6%80%81%E7%BB%91%E5%AE%9Adhcp">3.静态绑定DHCP</a></li>
<li><a href="#4%E5%BC%80%E5%90%AF%E6%97%A0%E7%BA%BF%E5%8A%9F%E8%83%BD">4.开启无线功能</a></li>
<li><a href="#5%E9%85%8D%E7%BD%AE%E6%97%A0%E7%BA%BF">5.配置无线</a></li>
<li><a href="#6%E6%B5%8B%E8%AF%95-2">6.测试</a></li>
</ul>
</li>
<li><a href="#%E5%A4%B1%E8%AF%AF%E5%8F%91%E7%94%9F%E7%9A%84%E5%8E%9F%E5%9B%A0">失误发生的原因</a></li>
<li><a href="#%E6%80%BB%E7%BB%93">总结</a></li>
</ul>
</li>
</ul>
</li>
</ul>

      </div>
    </div>

    <!-- Back to top -->
    <div class="fixed right-0 bottom-0 mb-4 mr-4 shadow w-8 h-8 rounded-full flex justify-center items-center z-10 cursor-pointer bg-white hover:shadow-lg transition-all dark:bg-gray-500 dark:text-gray-200" @click="backToUp" v-show="scrolled">
      <i class="ri-arrow-up-line"></i>
    </div>
  </div>

  <!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">
  <!-- Background of PhotoSwipe. 
        It's a separate element as animating opacity is faster than rgba(). -->
  <div class="pswp__bg">
  </div>
  <!-- Slides wrapper with overflow:hidden. -->
  <div class="pswp__scroll-wrap">
    <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
    <div class="pswp__container">
      <div class="pswp__item">
      </div>
      <div class="pswp__item">
      </div>
      <div class="pswp__item">
      </div>
    </div>
    <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
    <div class="pswp__ui pswp__ui--hidden">
      <div class="pswp__top-bar">
        <!--  Controls are self-explanatory. Order can be changed. -->
        <div class="pswp__counter">
        </div>
        <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
        <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
        <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
        <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
        <!-- element will get class pswp__preloader--active when preloader is running -->
        <div class="pswp__preloader">
          <div class="pswp__preloader__icn">
            <div class="pswp__preloader__cut">
              <div class="pswp__preloader__donut">
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
        <div class="pswp__share-tooltip">
        </div>
      </div>
      <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
      </button>
      <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
      </button>
      <div class="pswp__caption">
        <div class="pswp__caption__center">
        </div>
      </div>
    </div>
  </div>
</div>

  <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
  <script src="https://blog.ikozn.com//media/scripts/main.js"></script>
  
  <!-- Code Highlight -->
  
    <script src="https://blog.ikozn.com//media/prism.js"></script>
    <script>
      Prism.highlightAll()
    </script>
  

  <script src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"></script>
  <script>
    //拿到预览框架，也就是上面的html代码
    var pswpElement = document.querySelectorAll('.pswp')[0];
    //定义图片数组变量
    var imgitems;
    /**
    * 用于显示预览界面
    * @param index 图片数组下标
    */
    function viewImg(index) {
      //其它选项这里不做过多阐述，详情见官网
      var pswpoptions = {
        index: parseInt(index, 10), // 开始幻灯片索引。0是第一张幻灯片。必须是整数，而不是字符串。
        bgOpacity: 0.7, // 背景透明度，0-1
        maxSpreadZoom: 3, // 缩放级别，不要太大
      };
      //初始化并打开PhotoSwipe，pswpElement对应上面预览框架，PhotoSwipeUI_Default为皮肤，imgitems为图片数组，pswpoptions为选项
      var gallery = new PhotoSwipe(pswpElement, PhotoSwipeUI_Default, imgitems, pswpoptions);
      gallery.init()
    }
    /**
    * 用于添加图片点击事件
    * @param img 图片元素
    * @param index 所属下标（在imgitems中的位置）
    */
    function addImgClick(img, index) {
      img.onclick = function() {
        viewImg(index)
      }
    }
    /**
    * 轮询所有图片，获取src、width、height等数据，加入imgitems，并给图片元素添加事件
    * 最好在onload中执行该方法，本站因放在最底部，所以直接初始化
    * 异步加载图片可在图片元素创建完成后调用此方法
    */
    function initImg() {
      //重置图片数组
      imgitems = [];
      //查找class:markdown 下的所有img元素并遍历
      var imgs = document.querySelectorAll('.markdown img');
      for (var i = 0; i < imgs.length; i++) {
        var img = imgs[i];
        //本站相册初始为loading图片，真实图片放在data-src
        var ds = img.getAttribute("data-src");
        //创建image对象，用于获取图片宽高
        var imgtemp = new Image();
        //判断是否存在data-src
        if (ds != null && ds.length > 0) {
          imgtemp.src = ds
        } else {
          imgtemp.src = img.src
        }
        //判断是否存在缓存
        if (imgtemp.complete) {
          var imgobj = {
            "src": imgtemp.src,
            "w": imgtemp.width,
            "h": imgtemp.height,
          };
          imgitems[i] = imgobj;
          addImgClick(img, i);
        } else {
          console.log('进来了2')
          imgtemp.index = i;
          imgtemp.img = img;
          imgtemp.onload = function() {
            var imgobj = {
              "src": this.src,
              "w": this.width,
              "h": this.height,
            };
            //不要使用push，因为onload前后顺序会不同
            imgitems[this.index] = imgobj
            //添加点击事件
            addImgClick(this.img, this.index);
          }
        }
      }
    }
    //初始化
    initImg();
  </script>
</body>

</html>